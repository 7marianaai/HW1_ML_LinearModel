# Предсказание цены автомобиля

Здесь в файлах можно найти:
- [обучение линейной модели для предсказания цены автомобиля (ноутбук) с EDA](AI_HW1_Mariana_p2.ipynb),
- [сохранение полного пайплайна](models/full_pipe.pkl),
- Streamlit-приложение [`app_new.py`](app_new.py) с тремя вкладками: **EDA**, **Предсказание цены**, **Важность признаков**.
  - Ссылка на приложение: https://a-eta-mashina-skolko-stoit.streamlit.app/

## 1) Что было сделано?

### 1. Загрузка и первичная подготовка данных
- Проверены типы столбцов, пропуски, базовые распределения
- Признаки приведены к удобному для обучения виду (числовые поля приведены к `float`, категории — к строкам)
- Была проведена предобработка данных - из признаков с числовыми значениями убраны лишнеи символы

### 2. EDA (исследовательский анализ)
- Построены распределения `selling_price` и ключевых числовых признаков, затем сравнили с их логарифмами.
- Были проанализированы изменения распределения данных и характеристик после обработки пропусков и дубликатов
- Проанализированы связи цены с пробегом/возрастом и распределения по категориям
- Проанализирована связь цены с брендом
- Был проведен орреляционный анализ Пирсона, Спирмена, phik

### 3. Feature Engineering 
Были созданы новые признаки
- `*_was_nan` — флаги пропусков для: `mileage, engine, max_power, seats, torque_nm, max_torque_rpm`.
- `brand` из `name` → группировка редких брендов `brand_grp` (rare→other), признак `rare`.
- `premium` — флаг премиальных брендов (`Mercedes-Benz, BMW, Audi, ...`).
- `age = 2021 - year`, а также `age2 = age^2`.
- Логарифмы признаков: `log_km_driven`, `log_max_power`, `log_torque_nm` через `np.log1p`.
- `log_km_per_year = log_km_driven / age`.
- `owner_n` + `is_test_drive`.
- `is_automatic`.
- `engine_1 = engine / 1000`.
- `log_name_count` + `name_unseen`.
- **Target Encoding** по `name` → `name_te` (`TargetEncoder(min_samples_leaf=200, smoothing=50)`), таргет для TE — `log1p(selling_price)`.

### 4. Обработка данных в пайплайне
- Числовые: `SimpleImputer(median)` + `StandardScaler`.
- Категориальные: `SimpleImputer(most_frequent)` + `OneHotEncoder(drop='first', handle_unknown='ignore')`.
- Объединение: `ColumnTransformer`.

### 5. Обучение и подбор модели
Проверялись линейные модели: LinearRegression, Lasso, ElasticNet, Ridge.
Лучшей линейной моделью стала **Ridge (alpha=1)** в пайплайне с лог-трансформацией таргета.

## 2) Какие результаты были получены (метрики и интерпретация)

### Baseline (LinearRegression)
- **R2 test ≈ 0.600**
- **RMSE test ≈ 479 515**

### Итоговый пайплайн
- **R2 test ≈ 0.898**
- **RMSE test ≈ 241 634**

### “Бизнес”-метрика 
Доля предсказаний, попавших в ±10% от истинного значения:
- **Ridge Pipeline ≈ 0.389** (≈ 38.9%)

### Выводы:
- Заметное улучшение получилось только после создания новых признаков, между линейными моделями разница в метриках на базовом наборе признаков была незначительной и лучше всего себя показала LinearRegression
- Наиболее неприспособлены линейные модели к бизнес-метрикам, максимальный результат не превысил и 40% на лучшей модели, значит в будущем стоит попробовать другой подход определения цены - нелинейный

## 3) Что дало наибольший прирост качества
1. Логарифмирование таргета (`log1p`)
2. Target Encoding по `name` (`name_te`)
3. Создание новых признаков (`age`, лог-признаки, premium/rare, owner_n, is_automatic)

## 4) Что сделать не удалось и почему
- Существенно поднять метрику попадания в ±10% - метрики для бизнеса остались низкими
- Не исследовались более сложные нелинейные модели и связи для улучшения качества
- Можно было создать другие дополнительные признаки для лучшего улавливания связей между признаками

## 5) Было создано приложение, позволяющее предсказывать цену
Плюсы: 
- можно предсказать цену автомобиля по заданным параметрам
- в пайплайн входит обработка данных и создание новых признаков, входные признаки не нужно заранее подготавливать
- есть основная информация по модели - важность 30 признаков, а также визуализированы основные графики - распределение числовых и категориальных признаков, показаны некоторые зависимости цены от признаков, а также корреляция Пирсона
- графики интерактивные

Что исправить в будущем:
- сделать более яркие и удобные графики, лучше оформить страницу с EDA с заголовками и лучше настроенными под каждый признак графиками
- добавить информацию о метриках модели
- добавить информацию о датасете по методу describe, добавить к графику такую информацию по каждому признаку
- добавить возможность предсказывать цену на основе CSV-файла

