# Предсказание цены автомобиля

Здесь в файлах можно найти:
- обучение линейной модели для предсказания цены автомобиля (ноутбук) с EDA,
- сохранение полного пайплайна,
- Streamlit-приложение `app.py` с тремя вкладками: **EDA**, **Предсказание цены**, **Важность признаков**.

## 1) Что было сделано?

### 1. Загрузка и первичная подготовка данных
- Проверены типы столбцов, пропуски, базовые распределения.
- Признаки приведены к удобному для обучения виду (числовые поля приведены к `float`, категории — к строкам).
- Была проведена предобработка данных 

### 2. EDA (исследовательский анализ)
- Распределения `selling_price` и ключевых числовых признаков и сравнение с их логарифмами.
- Анализ изменения распределения данных и характеристик после обработки пропусков и дубликатов
- Связи цены с пробегом/возрастом и распределения по категориям
- Связь цены с брендом
- Корреляционный анализ Пирсона, Спирмена, phik

### 3. Feature Engineering 
Ключевые улучшения из ноутбука:
- `*_was_nan` — флаги пропусков для: `mileage, engine, max_power, seats, torque_nm, max_torque_rpm`.
- `brand` из `name` → группировка редких брендов `brand_grp` (rare→other), признак `rare`.
- `premium` — флаг премиальных брендов (`Mercedes-Benz, BMW, Audi, ...`).
- `age = 2021 - year`, а также `age2 = age^2`.
- Логарифмы признаков: `log_km_driven`, `log_max_power`, `log_torque_nm` через `np.log1p`.
- `log_km_per_year = log_km_driven / age`.
- `owner_n` + `is_test_drive`.
- `is_automatic`.
- `engine_1 = engine / 1000`.
- `log_name_count` + `name_unseen`.
- **Target Encoding** по `name` → `name_te` (`TargetEncoder(min_samples_leaf=200, smoothing=50)`), таргет для TE — `log1p(selling_price)`.

### 4. Обработка данных в пайплайне
- Числовые: `SimpleImputer(median)` + `StandardScaler`.
- Категориальные: `SimpleImputer(most_frequent)` + `OneHotEncoder(drop='first', handle_unknown='ignore')`.
- Объединение: `ColumnTransformer`.

### 5. Обучение и подбор модели
Проверялись линейные модели: LinearRegression, Lasso, ElasticNet, Ridge.
Лучшей линейной моделью стала **Ridge (alpha=1)** в пайплайне с лог-трансформацией таргета.

## 2) Какие результаты были получены (метрики и интерпретация)

### Baseline (LinearRegression)
- **R2 test ≈ 0.600**
- **RMSE test ≈ 479 515**

### Итоговый пайплайн
- **R2 test ≈ 0.898**
- **RMSE test ≈ 241 634**

### “Бизнес”-метрика 
Доля предсказаний, попавших в ±10% от истинного значения:
- **Ridge Pipeline ≈ 0.389** (≈ 38.9%)

## 3) Что дало наибольший прирост качества
1. Логарифмирование таргета (`log1p`).
2. Target Encoding по `name` (`name_te`).
3. Создание новых признаков (`age`, лог-признаки, premium/rare, owner_n, is_automatic).

## 4) Что сделать не удалось и почему (это нормально)
- Существенно поднять метрику попадания в ±10% - метрики для бизнеса остались низкии
- Не исследовались более сложные нелинейные модели и связи для улучшения качества

## 5) Было создано приложение с результатами модели 
